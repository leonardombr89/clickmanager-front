<mat-card class="cardWithShadow">

  <!-- Cabeçalho padrão -->
  <app-card-header [titulo]="isEditMode ? 'Editar Usuário' : 'Novo Usuário'" botaoTexto="Voltar" botaoIcone="arrow_back"
    botaoCor="primary" [botaoRota]="['/page/usuarios/listar']" [mostrarDivisor]="true">
  </app-card-header>

  <mat-card-content>

    <form [formGroup]="form" (ngSubmit)="onSubmit()">

      <!-- Nome -->
      <div class="m-b-16">
        <mat-label class="f-s-14 f-w-600 m-b-8 d-block">Nome</mat-label>
        <mat-form-field appearance="outline" class="w-100">
          <input matInput formControlName="nome" placeholder="Digite o nome completo" (blur)="updateErrorMessage()" />

          @if (form.get('nome')?.invalid && form.get('nome')?.touched) {
          <mat-error>{{ getErrorMessage('nome') }}</mat-error>
          }
        </mat-form-field>
      </div>

      <!-- E-mail -->
      <div class="m-t-16">
        <mat-label class="f-s-14 f-w-600 m-b-8 d-block">E-mail</mat-label>
        <mat-form-field appearance="outline" class="w-100">
          <input matInput type="email" formControlName="username" placeholder="exemplo@email.com"
            (blur)="updateErrorMessage()" />

          @if (form.get('username')?.invalid) {
          <mat-error>{{ getErrorMessage('username') }}</mat-error>
          }
        </mat-form-field>
      </div>

      <!-- Senha (somente criar OU se editar e campo manual) -->
      @if (!isEditMode) {
      <div class="m-t-16">
        <mat-label class="f-s-14 f-w-600 m-b-8 d-block">Senha</mat-label>
        <mat-form-field appearance="outline" class="w-100">
          <input matInput type="password" formControlName="senha" placeholder="Digite a senha"
            (blur)="updateErrorMessage()" />

          @if (form.get('senha')?.invalid) {
          <mat-error>{{ getErrorMessage('senha') }}</mat-error>
          }
        </mat-form-field>
      </div>
      }

      <!-- Perfil -->
      <div class="m-t-16">
        <mat-label class="f-s-14 f-w-600 m-b-8 d-block">Perfil</mat-label>
        <mat-form-field appearance="outline" class="w-100">
          <mat-select formControlName="perfilId">
            <mat-option *ngFor="let perfil of perfis" [value]="perfil.id">
              {{ perfil.nome }}
            </mat-option>
          </mat-select>

          @if (form.get('perfilId')?.invalid) {
          <mat-error>{{ getErrorMessage('perfilId') }}</mat-error>
          }
        </mat-form-field>
      </div>

      <!-- Ativo (somente no modo edição) -->
      @if (isEditMode) {
      <div class="m-t-20">
        <mat-slide-toggle formControlName="ativo">
          Usuário Ativo
        </mat-slide-toggle>
      </div>
      }

      <!-- Botões -->
      <div class="m-t-30 d-flex gap-2 flex-wrap">
        <button mat-flat-button class="bg-error text-white" type="button" routerLink="/page/usuarios">
          Cancelar
        </button>

        <button mat-flat-button color="primary" type="submit" [disabled]="form.invalid">
          {{ isEditMode ? 'Atualizar Usuário' : 'Salvar Usuário' }}
        </button>
      </div>

    </form>

  </mat-card-content>
</mat-card>