<div class="print-container"
     [ngClass]="{ 'duas-vias': isDuasVias, 'pedido-completo': !isDuasVias }"
     *ngIf="pedido as p">

  <!-- Pedido Completo (uma única via) -->
  <div *ngIf="!isDuasVias" class="pedido-via">
    <div class="header-print">
      <div class="empresa-box" *ngIf="empresa">
        <div class="empresa-header">
          <div class="empresa-logo" *ngIf="empresa?.logoPath">
            <img [src]="empresa?.logoPath" alt="Logo {{ empresa?.nome }}" />
          </div>
          <div class="empresa-nome">{{ empresa?.nome }}</div>
          <div class="pedido-numero">
            <div class="label">Pedido</div>
            <div class="valor">#{{ displayNumero(p) }}</div>
          </div>
        </div>
        <div class="empresa-grid">
          <div>
            <div class="empresa-linha" *ngIf="empresa?.cnpj">CNPJ: {{ empresa?.cnpj }}</div>
            <div class="empresa-linha" *ngIf="empresa?.email">Email: {{ empresa?.email }}</div>
          </div>
          <div>
            <div class="empresa-linha" *ngIf="empresa?.telefone">Tel: {{ empresa?.telefone }}</div>
            <div class="empresa-linha" *ngIf="empresa?.endereco">
              {{ empresa?.endereco?.logradouro }}{{ empresa?.endereco?.numero ? ', ' + empresa?.endereco?.numero : '' }}
              <span *ngIf="empresa?.endereco?.bairro"> - {{ empresa?.endereco?.bairro }}</span>
              <span *ngIf="empresa?.endereco?.cidade"> - {{ empresa?.endereco?.cidade }}</span>
              <span *ngIf="empresa?.endereco?.estado">/{{ empresa?.endereco?.estado }}</span>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="info-grid">
      <div>
        <div class="info-label">Status</div>
        <div class="info-value">{{ p.status }}</div>
      </div>
      <div>
        <div class="info-label">Data</div>
        <div class="info-value">{{ p.dataCriacao | date:'dd/MM/yyyy HH:mm' }}</div>
      </div>
      <div>
        <div class="info-label">Cliente</div>
        <div class="info-value">{{ p.cliente?.nome || '—' }}</div>
      </div>
      <div>
        <div class="info-label">Responsável</div>
        <div class="info-value">{{ p.responsavel?.nome || '—' }}</div>
      </div>
    </div>

    <hr>

    <h4 class="f-s-16 f-w-600">Itens</h4>
    <table class="items-table w-100 f-s-14">
      <thead>
        <tr>
          <th class="descricao">Descrição</th>
          <th class="qty">Qtd</th>
          <th class="valor">Valor</th>
          <th class="valor">Subtotal</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let item of (p.itens || []); trackBy: trackByItem">
          <td class="descricao">{{ item?.descricao || 'Item' }}</td>
          <td class="qty">{{ item?.quantidade ?? 0 }}</td>
          <td class="valor">{{ (item?.valor ?? 0) | currency:'BRL':'symbol':'1.2-2' }}</td>
          <td class="valor">{{ (item?.subTotal ?? 0) | currency:'BRL':'symbol':'1.2-2' }}</td>
        </tr>
      </tbody>
    </table>

    <div class="totais-inline">
      <div><span class="label">Subtotal:</span> {{ (p.subTotal ?? 0) | currency:'BRL':'symbol':'1.2-2' }}</div>
      <div><span class="label">Frete:</span> {{ (p.frete ?? 0)   | currency:'BRL':'symbol':'1.2-2' }}</div>
      <div><span class="label">Acréscimo:</span> {{ (p.acrescimo ?? 0) | currency:'BRL':'symbol':'1.2-2' }}</div>
      <div><span class="label">Desconto:</span> {{ (p.desconto ?? 0) | currency:'BRL':'symbol':'1.2-2' }}</div>
      <div class="total"><span class="label">Total:</span> {{ (p.total ?? 0) | currency:'BRL':'symbol':'1.2-2' }}</div>
    </div>
  </div>

  <!-- Pedido em Duas Vias -->
  <ng-container *ngIf="isDuasVias">
    <div class="duas-vias-wrapper">
      <div class="pedido-via">
        <ng-container *ngTemplateOutlet="viaTemplate; context: { pedido: p }"></ng-container>
      </div>
      <div class="pedido-via">
        <ng-container *ngTemplateOutlet="viaTemplate; context: { pedido: p }"></ng-container>
      </div>
    </div>
  </ng-container>
</div>

<ng-template #viaTemplate let-pedido="pedido">
  <div class="header-print">
    <div class="empresa-box" *ngIf="empresa">
      <div class="empresa-header">
        <div class="empresa-logo" *ngIf="empresa?.logoPath">
          <img [src]="empresa?.logoPath" alt="Logo {{ empresa?.nome }}" />
        </div>
        <div class="empresa-nome">{{ empresa?.nome }}</div>
        <div class="pedido-numero">
          <div class="label">Pedido</div>
          <div class="valor">#{{ displayNumero(pedido) }}</div>
        </div>
      </div>
      <div class="empresa-grid">
        <div>
          <div class="empresa-linha" *ngIf="empresa?.cnpj">CNPJ: {{ empresa?.cnpj }}</div>
          <div class="empresa-linha" *ngIf="empresa?.email">Email: {{ empresa?.email }}</div>
        </div>
        <div>
          <div class="empresa-linha" *ngIf="empresa?.telefone">Tel: {{ empresa?.telefone }}</div>
          <div class="empresa-linha" *ngIf="empresa?.endereco">
            {{ empresa?.endereco?.logradouro }}{{ empresa?.endereco?.numero ? ', ' + empresa?.endereco?.numero : '' }}
            <span *ngIf="empresa?.endereco?.bairro"> - {{ empresa?.endereco?.bairro }}</span>
            <span *ngIf="empresa?.endereco?.cidade"> - {{ empresa?.endereco?.cidade }}</span>
            <span *ngIf="empresa?.endereco?.estado">/{{ empresa?.endereco?.estado }}</span>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="info-grid">
    <div>
      <div class="info-label">Status</div>
      <div class="info-value">{{ pedido.status }}</div>
    </div>
    <div>
      <div class="info-label">Data</div>
      <div class="info-value">{{ pedido.dataCriacao | date:'dd/MM/yyyy HH:mm' }}</div>
    </div>
    <div>
      <div class="info-label">Cliente</div>
      <div class="info-value">{{ pedido.cliente?.nome || '—' }}</div>
    </div>
    <div>
      <div class="info-label">Responsável</div>
      <div class="info-value">{{ pedido.responsavel?.nome || '—' }}</div>
    </div>
  </div>

  <hr>

  <h4 class="f-s-16 f-w-600">Itens</h4>
  <table class="items-table w-100 f-s-14">
    <thead>
      <tr>
        <th class="descricao">Descrição</th>
        <th class="qty">Qtd</th>
        <th class="valor">Valor</th>
        <th class="valor">Subtotal</th>
      </tr>
    </thead>
    <tbody>
      <tr *ngFor="let item of (pedido.itens || []); trackBy: trackByItem">
        <td class="descricao">{{ item?.descricao || 'Item' }}</td>
        <td class="qty">{{ item?.quantidade ?? 0 }}</td>
        <td class="valor">{{ (item?.valor ?? 0) | currency:'BRL':'symbol':'1.2-2' }}</td>
        <td class="valor">{{ (item?.subTotal ?? 0) | currency:'BRL':'symbol':'1.2-2' }}</td>
      </tr>
    </tbody>
  </table>

  <div class="totais-inline">
    <div><span class="label">Subtotal:</span> {{ (pedido.subTotal ?? 0) | currency:'BRL':'symbol':'1.2-2' }}</div>
    <div><span class="label">Frete:</span> {{ (pedido.frete ?? 0)   | currency:'BRL':'symbol':'1.2-2' }}</div>
    <div><span class="label">Acréscimo:</span> {{ (pedido.acrescimo ?? 0) | currency:'BRL':'symbol':'1.2-2' }}</div>
    <div><span class="label">Desconto:</span> {{ (pedido.desconto ?? 0) | currency:'BRL':'symbol':'1.2-2' }}</div>
    <div class="total"><span class="label">Total:</span> {{ (pedido.total ?? 0) | currency:'BRL':'symbol':'1.2-2' }}</div>
  </div>
</ng-template>
<!-- Botão fora da área de impressão -->
<div class="text-center m-t-24 no-print">
  <button mat-stroked-button (click)="onPrint()">Imprimir</button>
</div>

<!-- Loading simples (opcional) -->
<div *ngIf="!pedido" class="text-center m-t-24">
  Carregando...
</div>
