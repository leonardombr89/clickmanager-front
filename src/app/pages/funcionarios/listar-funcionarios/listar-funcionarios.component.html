<app-page-card
  titulo="Funcionários"
  subtitulo="Gestão de colaboradores (MVP mockado)"
  botaoTexto="Novo Funcionário"
  botaoIcone="add"
  [botaoRota]="['/page/funcionarios/novo']"
  [helpRota]="['/page/ajuda']"
  helpFragment="funcionarios"
  helpTexto=""
  helpIcone="help_outline"
  [permissao]="['FUNCIONARIO_CRIAR']"
  [mostrarDivisor]="true"
>
  <app-section-card [divider]="false">
    <div class="kpi-grid m-b-8">
      <div class="kpi">
        <span>Total</span>
        <strong>{{ resumo.total }}</strong>
      </div>
      <div class="kpi">
        <span>Ativos</span>
        <strong>{{ resumo.ativos }}</strong>
      </div>
      <div class="kpi">
        <span>Afastados</span>
        <strong>{{ resumo.afastados }}</strong>
      </div>
      <div class="kpi">
        <span>Desligados</span>
        <strong>{{ resumo.desligados }}</strong>
      </div>
    </div>
  </app-section-card>

  <app-filtro-pesquisa-card
      titulo="Pesquisar"
      placeholder="Pesquisar por nome, CPF, e-mail, cargo ou setor"
      [statusOptions]="statusOptions"
      [statusSelecionado]="statusSelecionado"
      (pesquisar)="onPesquisar($event)"
      (statusChange)="onStatusChange($event)">
  </app-filtro-pesquisa-card>

  <app-section-card [divider]="false">
    <div class="table-responsive">
      <table mat-table [dataSource]="funcionarios" class="w-100">
        <ng-container matColumnDef="nome">
          <th mat-header-cell *matHeaderCellDef>Nome</th>
          <td mat-cell *matCellDef="let f">{{ f.nome }}</td>
        </ng-container>

        <ng-container matColumnDef="cargo">
          <th mat-header-cell *matHeaderCellDef>Cargo</th>
          <td mat-cell *matCellDef="let f">{{ f.cargo }}</td>
        </ng-container>

        <ng-container matColumnDef="setor">
          <th mat-header-cell *matHeaderCellDef>Setor</th>
          <td mat-cell *matCellDef="let f">{{ f.setor }}</td>
        </ng-container>

        <ng-container matColumnDef="status">
          <th mat-header-cell *matHeaderCellDef>Status</th>
          <td mat-cell *matCellDef="let f">
            <app-status-badge [status]="f.status"></app-status-badge>
          </td>
        </ng-container>

        <ng-container matColumnDef="admissao">
          <th mat-header-cell *matHeaderCellDef>Admissão</th>
          <td mat-cell *matCellDef="let f">{{ f.dataAdmissao | date:'dd/MM/yyyy' }}</td>
        </ng-container>

        <ng-container matColumnDef="acoes">
          <th mat-header-cell *matHeaderCellDef>Ações</th>
          <td mat-cell *matCellDef="let f">
            <button mat-icon-button color="primary" (click)="detalhar(f)" matTooltip="Detalhar" *temPermissao="['FUNCIONARIO_VER']">
              <mat-icon>visibility</mat-icon>
            </button>
            <ng-container *ngIf="f.status !== 'DESLIGADO'">
              <button mat-icon-button color="accent" (click)="editar(f)" matTooltip="Editar" *temPermissao="['FUNCIONARIO_EDITAR']">
                <mat-icon>edit</mat-icon>
              </button>
            </ng-container>
          </td>
        </ng-container>

        <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
        <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
      </table>
    </div>

    <p class="text-muted m-t-16" *ngIf="!funcionarios.length">Nenhum funcionário encontrado.</p>
  </app-section-card>
</app-page-card>
